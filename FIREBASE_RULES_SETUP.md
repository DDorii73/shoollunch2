# Firebase ê·œì¹™ ì„¤ì • ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” Firestore Databaseì™€ Storageì˜ ë³´ì•ˆ ê·œì¹™ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.

## ğŸ“‹ ìš”êµ¬ì‚¬í•­

1. **ì¼ë°˜ ì‚¬ìš©ì (Google ë¡œê·¸ì¸)**
   - ë³¸ì¸ì˜ ì±—ë´‡ ëŒ€í™”, ì ì‹¬/ê°„ì‹ ì…ë ¥ ì •ë³´, ê°œì¸ì •ë³´ë§Œ ì½ê¸°/ì“°ê¸° ê°€ëŠ¥

2. **ê´€ë¦¬ì (ì§€ì •ëœ UID)**
   - ëª¨ë“  ì‚¬ìš©ìì˜ ë°ì´í„° ì½ê¸° ê°€ëŠ¥
   - í•„ìš” ì‹œ ì‚­ì œ ê°€ëŠ¥

## ğŸ”§ ì„¤ì • ë°©ë²•

### 1. ê´€ë¦¬ì UID í™•ì¸

ë¨¼ì € ê´€ë¦¬ìë¡œ ì‚¬ìš©í•  Google ê³„ì •ì˜ UIDë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.

1. ì›¹ì•±ì— ê´€ë¦¬ì ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
2. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ (F12) ì—´ê¸°
3. Console íƒ­ì—ì„œ ë‹¤ìŒ ì½”ë“œ ì‹¤í–‰:
   ```javascript
   import { auth } from './src/firebaseConfig.js';
   console.log('ê´€ë¦¬ì UID:', auth.currentUser.uid);
   ```
   ë˜ëŠ” Firebase Console â†’ Authentication â†’ Usersì—ì„œ UID í™•ì¸

### 2. Firestore ê·œì¹™ ì„¤ì •

1. **Firebase Console ì ‘ì†**
   - https://console.firebase.google.com ì ‘ì†
   - í”„ë¡œì íŠ¸ ì„ íƒ

2. **Firestore Databaseë¡œ ì´ë™**
   - ì™¼ìª½ ë©”ë‰´ì—ì„œ "Firestore Database" í´ë¦­
   - ìƒë‹¨ íƒ­ì—ì„œ "ê·œì¹™" í´ë¦­

3. **ê·œì¹™ í¸ì§‘**
   - `firestore.rules` íŒŒì¼ì„ ì—´ì–´ì„œ ë‚´ìš© í™•ì¸
   - `isAdmin()` í•¨ìˆ˜ ë‚´ë¶€ì— ê´€ë¦¬ì UID ì¶”ê°€:
     ```javascript
     function isAdmin() {
       return request.auth != null && (
         request.auth.uid == 'your-admin-uid-here' ||  // ì—¬ê¸°ì— ê´€ë¦¬ì UID ì…ë ¥
         request.auth.uid == 'another-admin-uid'       // ì—¬ëŸ¬ ê´€ë¦¬ì ì¶”ê°€ ê°€ëŠ¥ (|| ì—°ì‚°ì ì‚¬ìš©)
       );
     }
     ```

4. **ê·œì¹™ ë°°í¬**
   - Firebase Consoleì˜ ê·œì¹™ í¸ì§‘ê¸°ì—ì„œ `firestore.rules` ë‚´ìš© ë¶™ì—¬ë„£ê¸°
   - "ê²Œì‹œ" ë²„íŠ¼ í´ë¦­

   ë˜ëŠ” Firebase CLI ì‚¬ìš©:
   ```bash
   firebase deploy --only firestore:rules
   ```

### 3. Storage ê·œì¹™ ì„¤ì •

1. **Firebase Console ì ‘ì†**
   - ê°™ì€ í”„ë¡œì íŠ¸ì—ì„œ "Storage" í´ë¦­
   - ìƒë‹¨ íƒ­ì—ì„œ "ê·œì¹™" í´ë¦­

2. **ê·œì¹™ í¸ì§‘**
   - `storage.rules` íŒŒì¼ì„ ì—´ì–´ì„œ ë‚´ìš© í™•ì¸
   - `isAdmin()` í•¨ìˆ˜ ë‚´ë¶€ì— ê´€ë¦¬ì UID ì¶”ê°€ (Firestoreì™€ ë™ì¼í•œ UID ì‚¬ìš©):
     ```javascript
     function isAdmin() {
       return request.auth != null && (
         request.auth.uid == 'your-admin-uid-here' ||  // Firestoreì™€ ë™ì¼í•œ UID
         request.auth.uid == 'another-admin-uid'       // ì—¬ëŸ¬ ê´€ë¦¬ì ì¶”ê°€ ê°€ëŠ¥ (|| ì—°ì‚°ì ì‚¬ìš©)
       );
     }
     ```

3. **ê·œì¹™ ë°°í¬**
   - Firebase Consoleì˜ ê·œì¹™ í¸ì§‘ê¸°ì—ì„œ `storage.rules` ë‚´ìš© ë¶™ì—¬ë„£ê¸°
   - "ê²Œì‹œ" ë²„íŠ¼ í´ë¦­

   ë˜ëŠ” Firebase CLI ì‚¬ìš©:
   ```bash
   firebase deploy --only storage:rules
   ```

## ğŸ“ ë°ì´í„° êµ¬ì¡°

### Firestore ì»¬ë ‰ì…˜

- **`userRecords/{userId}`**: ì‚¬ìš©ì ê°œì¸ì •ë³´ (í‚¤, ëª¸ë¬´ê²Œ, ë‚˜ì´, ì„±ë³„, ê¸°ì´ˆëŒ€ì‚¬ëŸ‰)
  - **`dailyRecords/{date}`**: ì¼ë³„ ê¸°ë¡ (ì„œë¸Œì»¬ë ‰ì…˜)

- **`foodRecords/{recordId}`**: ì ì‹¬/ê°„ì‹ ì…ë ¥ ì •ë³´
  - `userId`: ì‚¬ìš©ì UID
  - `date`: ë‚ ì§œ
  - `type`: 'lunch' ë˜ëŠ” 'snack'
  - `records`: ìŒì‹ ê¸°ë¡ ë°°ì—´

- **`chatHistory/{chatId}`**: ì±—ë´‡ ëŒ€í™” ê¸°ë¡
  - `userId`: ì‚¬ìš©ì UID
  - `date`: ë‚ ì§œ
  - `type`: 'mealChat' ë˜ëŠ” 'nutritionChat'
  - `messages`: ëŒ€í™” ë©”ì‹œì§€ ë°°ì—´

### Storage êµ¬ì¡°

- **`users/{userId}/...`**: ì‚¬ìš©ìë³„ íŒŒì¼ ì €ì¥ì†Œ
  - ì˜ˆ: `users/{userId}/profile.jpg`
  - ì˜ˆ: `users/{userId}/snack-images/{imageId}.jpg`

- **`public/...`**: ê³µìš© íŒŒì¼ (ëª¨ë“  ì¸ì¦ëœ ì‚¬ìš©ì ì½ê¸° ê°€ëŠ¥)

## ğŸ”’ ë³´ì•ˆ ê·œì¹™ ìš”ì•½

### ì¼ë°˜ ì‚¬ìš©ì ê¶Œí•œ

| ì»¬ë ‰ì…˜/ê²½ë¡œ | ì½ê¸° | ì“°ê¸° | ì‚­ì œ |
|------------|------|------|------|
| `userRecords/{ë³¸ì¸UID}` | âœ… | âœ… | âœ… |
| `foodRecords` (ë³¸ì¸ ë°ì´í„°) | âœ… | âœ… | âœ… |
| `chatHistory` (ë³¸ì¸ ë°ì´í„°) | âœ… | âœ… | âœ… |
| `users/{ë³¸ì¸UID}/...` | âœ… | âœ… | âœ… |
| ë‹¤ë¥¸ ì‚¬ìš©ì ë°ì´í„° | âŒ | âŒ | âŒ |

### ê´€ë¦¬ì ê¶Œí•œ

| ì»¬ë ‰ì…˜/ê²½ë¡œ | ì½ê¸° | ì“°ê¸° | ì‚­ì œ |
|------------|------|------|------|
| ëª¨ë“  `userRecords` | âœ… | âŒ | âœ… |
| ëª¨ë“  `foodRecords` | âœ… | âŒ | âœ… |
| ëª¨ë“  `chatHistory` | âœ… | âŒ | âœ… |
| ëª¨ë“  `users/{userId}/...` | âœ… | âŒ | âœ… |

**ì°¸ê³ **: ê´€ë¦¬ìëŠ” ì½ê¸°ì™€ ì‚­ì œë§Œ ê°€ëŠ¥í•˜ë©°, ì“°ê¸°ëŠ” ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ë°ì´í„° ìˆ˜ì •ì´ í•„ìš”í•œ ê²½ìš° Firebase Consoleì—ì„œ ì§ì ‘ ìˆ˜ì •í•˜ê±°ë‚˜, ê´€ë¦¬ì ì „ìš© ê¸°ëŠ¥ì„ ì¶”ê°€ë¡œ ê°œë°œí•´ì•¼ í•©ë‹ˆë‹¤.

## âœ… ê·œì¹™ í…ŒìŠ¤íŠ¸

ê·œì¹™ì„ ë°°í¬í•œ í›„ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

1. **ì¼ë°˜ ì‚¬ìš©ìë¡œ ë¡œê·¸ì¸**
   - ë³¸ì¸ ë°ì´í„° ì½ê¸°/ì“°ê¸° ê°€ëŠ¥í•œì§€ í™•ì¸
   - ë‹¤ë¥¸ ì‚¬ìš©ì ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œì§€ í™•ì¸

2. **ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸**
   - ëª¨ë“  ì‚¬ìš©ì ë°ì´í„° ì½ê¸° ê°€ëŠ¥í•œì§€ í™•ì¸
   - ë°ì´í„° ì‚­ì œ ê°€ëŠ¥í•œì§€ í™•ì¸

3. **ë¡œê·¸ì•„ì›ƒ ìƒíƒœ**
   - ëª¨ë“  ë°ì´í„° ì ‘ê·¼ ë¶ˆê°€ëŠ¥í•œì§€ í™•ì¸

## ğŸš¨ ë¬¸ì œ í•´ê²°

### ê¶Œí•œ ì˜¤ë¥˜ ë°œìƒ ì‹œ

1. **Firebase Consoleì—ì„œ ê·œì¹™ í™•ì¸**
   - ê·œì¹™ì´ ì˜¬ë°”ë¥´ê²Œ ë°°í¬ë˜ì—ˆëŠ”ì§€ í™•ì¸
   - êµ¬ë¬¸ ì˜¤ë¥˜ê°€ ì—†ëŠ”ì§€ í™•ì¸

2. **ê´€ë¦¬ì UID í™•ì¸**
   - `isAdmin()` í•¨ìˆ˜ì˜ UID ë°°ì—´ì— ì˜¬ë°”ë¥¸ UIDê°€ ìˆëŠ”ì§€ í™•ì¸
   - UID ì•ë’¤ ê³µë°±ì´ ì—†ëŠ”ì§€ í™•ì¸

3. **ë¸Œë¼ìš°ì € ìºì‹œ ì‚­ì œ**
   - ê·œì¹™ ë³€ê²½ í›„ ë¸Œë¼ìš°ì € ìºì‹œë¥¼ ì‚­ì œí•˜ê³  ë‹¤ì‹œ ì‹œë„

### Firebase CLI ì‚¬ìš© ì‹œ

```bash
# Firebase CLI ì„¤ì¹˜
npm install -g firebase-tools

# Firebase ë¡œê·¸ì¸
firebase login

# í”„ë¡œì íŠ¸ ì´ˆê¸°í™” (ì•„ì§ ì•ˆ í–ˆë‹¤ë©´)
firebase init firestore
firebase init storage

# ê·œì¹™ ë°°í¬
firebase deploy --only firestore:rules
firebase deploy --only storage:rules

# ë˜ëŠ” í•œ ë²ˆì— ë°°í¬
firebase deploy --only firestore:rules,storage:rules
```

## ğŸ“ ì°¸ê³ ì‚¬í•­

- ê·œì¹™ ë³€ê²½ì€ ì¦‰ì‹œ ì ìš©ë©ë‹ˆë‹¤ (ëª‡ ì´ˆ ë‚´)
- ê·œì¹™ í…ŒìŠ¤íŠ¸ëŠ” Firebase Consoleì˜ "ê·œì¹™ ì‹œë®¬ë ˆì´í„°"ì—ì„œ ê°€ëŠ¥í•©ë‹ˆë‹¤
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ê·œì¹™ ë³€ê²½ ì „ì— ì¶©ë¶„íˆ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”

