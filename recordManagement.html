<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>기록 관리 - 밥로그</title>
  <link rel="icon" type="image/png" href="/밥로그.png">
  <link rel="stylesheet" href="/src/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- 경로 자동 수정: /recordManagement로 접근하면 /recordManagement.html로 리다이렉트 (즉시 실행) -->
  <script>
    (function() {
      var pathname = window.location.pathname;
      if (pathname === '/recordManagement' || pathname === '/recordManagement/' || pathname.startsWith('/recordManagement/')) {
        var newUrl = '/recordManagement.html' + window.location.search + window.location.hash;
        window.location.replace(newUrl);
      }
    })();
  </script>
</head>
<body>
  <div class="student-container">
    <button id="home-btn" class="home-btn" onclick="window.location.href='/index.html'" title="홈으로">
      <img src="/home.png" alt="홈으로" class="home-icon">
    </button>
    <header class="student-header">
      <div class="header-logo-container">
        <img src="/밥로그.png" alt="밥로그" class="header-logo">
        <h1>기록 관리</h1>
      </div>
    </header>

    <div class="record-header-image">
      <img src="/밥학생.png" alt="밥학생" class="record-student-image">
    </div>

    <!-- 우리학교 등록 섹션 -->
    <div class="record-section">
      <div class="record-container">
        <h2>우리학교 등록</h2>
        <p class="meal-description">학교 정보를 입력하면 급식 정보를 가져올 수 있어요.</p>
        
        <div class="meal-record">
          <div class="input-section">
            <div class="input-group">
              <label for="school-name-input">학교 이름</label>
              <div style="display: flex; gap: 8px;">
                <input type="text" id="school-name-input" placeholder="예: 서울중학교" style="flex: 1;" />
                <button id="search-school-btn" class="search-btn" type="button">찾기</button>
              </div>
              <div id="school-search-results" style="margin-top: 10px; display: none;"></div>
            </div>
            
            <div class="input-group" style="display: none;">
              <label for="education-office-code-input">교육청 코드</label>
              <input type="text" id="education-office-code-input" placeholder="예: B10 (서울특별시교육청)" maxlength="3" />
              <small style="color: var(--text-light); font-size: 12px; margin-top: 4px; display: block;">
                주요 교육청 코드: B10(서울), C10(부산), D10(대구), E10(인천), F10(광주), G10(대전), H10(울산), I10(세종), J10(경기), K10(강원), M10(충북), N10(충남), P10(전북), Q10(전남), R10(경북), S10(경남), T10(제주)
              </small>
            </div>
            
            <div class="input-group" style="display: none;">
              <label for="school-code-input">학교 코드</label>
              <input type="text" id="school-code-input" placeholder="예: 7010569" maxlength="10" />
              <small style="color: var(--text-light); font-size: 12px; margin-top: 4px; display: block;">
                학교 고유 코드를 입력하세요. 학교 홈페이지나 교육청 사이트에서 확인할 수 있어요.
              </small>
            </div>
            
            <button id="save-school-btn" class="submit-btn">학교 정보 저장</button>
          </div>
        </div>
        
        <div id="saved-school-info" class="meal-record hidden">
          <h3>저장된 학교 정보</h3>
          <div class="info-item">
            <span>학교 이름:</span>
            <span id="saved-school-name">-</span>
          </div>
          <div class="info-item">
            <span>교육청 코드:</span>
            <span id="saved-education-office-code">-</span>
          </div>
          <div class="info-item">
            <span>학교 코드:</span>
            <span id="saved-school-code">-</span>
          </div>
          <button id="edit-school-btn" class="submit-btn" style="margin-top: 15px;">학교 정보 수정</button>
        </div>
      </div>
    </div>

    <div class="record-section">
      <div class="record-container">
        <h2>신체 정보 입력</h2>
        <p class="meal-description">키와 몸무게를 입력하면 비만율(BMI)과 기초대사량(BMR)을 계산해줄게요.</p>
        
        <div class="meal-record">
          <div class="input-section">
            <div class="input-group">
              <label for="height-input">키 (cm)</label>
              <input type="number" id="height-input" placeholder="예: 170" min="50" max="250" step="0.1" />
            </div>
            
            <div class="input-group">
              <label for="weight-input">몸무게 (kg)</label>
              <input type="number" id="weight-input" placeholder="예: 60" min="20" max="200" step="0.1" />
            </div>
            
            <div class="input-group">
              <label for="target-weight-input">목표 몸무게 (kg)</label>
              <input type="number" id="target-weight-input" placeholder="예: 55" min="20" max="200" step="0.1" />
            </div>
            
            <div class="input-group">
              <label for="age-input">나이</label>
              <input type="number" id="age-input" placeholder="예: 15" min="5" max="30" />
            </div>
            
            <div class="input-group">
              <label>성별</label>
              <div class="gender-selector">
                <label>
                  <input type="radio" name="gender" value="male" checked>
                  남성
                </label>
                <label>
                  <input type="radio" name="gender" value="female">
                  여성
                </label>
              </div>
            </div>
            
            <button id="calculate-btn" class="submit-btn">저장하기</button>
          </div>
        </div>

        <!-- 알레르기 입력 섹션 -->
        <div class="meal-record">
          <h3>알레르기 정보</h3>
          <p class="meal-description">본인에게 해당하는 알레르기 항목을 선택해주세요.</p>
          
          <div class="allergy-section">
            <div class="allergy-grid">
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="난류">
                <span>① 난류</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="우유">
                <span>② 우유</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="메밀">
                <span>③ 메밀</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="땅콩">
                <span>④ 땅콩</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="대두">
                <span>⑤ 대두</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="밀">
                <span>⑥ 밀</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="고등어">
                <span>⑦ 고등어</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="게">
                <span>⑧ 게</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="새우">
                <span>⑨ 새우</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="돼지고기">
                <span>⑩ 돼지고기</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="복숭아">
                <span>⑪ 복숭아</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="토마토">
                <span>⑫ 토마토</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="아황산류">
                <span>⑬ 아황산류</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="호두">
                <span>⑭ 호두</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="닭고기">
                <span>⑮ 닭고기</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="쇠고기">
                <span>⑯ 쇠고기</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="오징어">
                <span>⑰ 오징어</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="조개류">
                <span>⑱ 조개류</span>
              </label>
              <label class="allergy-checkbox">
                <input type="checkbox" name="allergy" value="잣">
                <span>⑲ 잣</span>
              </label>
            </div>
            <button id="save-allergy-btn" class="submit-btn">알레르기 정보 저장</button>
          </div>
          
          <div id="saved-allergy-info" class="saved-allergy-info hidden">
            <h4>저장된 알레르기 정보</h4>
            <div id="saved-allergy-list" class="allergy-tags"></div>
          </div>
        </div>
        
        <div id="result-section" class="meal-record hidden">
          <h3>계산 결과</h3>
          <div class="result-cards">
            <div class="result-card">
              <h4>BMI (비만율)</h4>
              <p class="result-value" id="bmi-value">-</p>
              <p class="result-status" id="bmi-status">-</p>
            </div>
            <div class="result-card">
              <h4>BMR (기초대사량)</h4>
              <p class="result-value" id="bmr-value">-</p>
              <p class="result-unit">kcal/일</p>
            </div>
          </div>
          <button id="save-btn" class="submit-btn">저장하기</button>
        </div>
        
        <div id="saved-info" class="meal-record hidden">
          <h3>저장된 정보</h3>
          <div class="info-item">
            <span>키:</span>
            <span id="saved-height">-</span> cm
          </div>
          <div class="info-item">
            <span>몸무게:</span>
            <span id="saved-weight">-</span> kg
          </div>
          <div class="info-item">
            <span>목표 몸무게:</span>
            <span id="saved-target-weight">-</span> kg
          </div>
          <div class="info-item">
            <span>나이:</span>
            <span id="saved-age">-</span> 세
          </div>
          <div class="info-item">
            <span>성별:</span>
            <span id="saved-gender">-</span>
          </div>
          <div class="info-item">
            <span>BMI:</span>
            <span id="saved-bmi">-</span>
            <span class="bmi-range-indicator" style="font-size: 12px; color: var(--text-light); margin-left: 8px;">(정상: 18.5~23)</span>
          </div>
          <div class="info-item">
            <span>BMR:</span>
            <span id="saved-bmr">-</span> kcal/일
          </div>
          <div class="info-item">
            <span>알레르기:</span>
            <span id="saved-allergy-summary">없음</span>
          </div>
          <p class="update-date">최종 업데이트: <span id="update-date">-</span></p>
        </div>
      </div>
    </div>

    <!-- 월별 음식 기록 섹션 -->
    <div class="record-section">
      <div class="record-container">
        <h2>월별 음식 기록</h2>
        <p class="meal-description">월을 선택하여 해당 월에 먹었던 음식들을 확인하세요.</p>
        
        <div class="meal-record">
          <div class="month-selector">
            <div class="input-group">
              <label for="month-select">월 선택</label>
              <select id="month-select" class="month-select">
                <option value="">월을 선택하세요</option>
              </select>
            </div>
            <button id="load-food-records-btn" class="submit-btn">기록 불러오기</button>
          </div>
          
          <div id="food-records-container" class="food-records-container">
            <p class="no-records-message">월을 선택하고 기록 불러오기를 클릭하세요.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- 그래프 섹션 -->
    <div class="record-section">
      <div class="record-container">
        <h2>몸무게 및 BMI 추이</h2>
        <p class="meal-description">날짜 범위를 선택하여 몸무게와 BMI의 변화를 확인하세요.</p>
        
        <div class="meal-record">
          <div class="date-range-selector">
            <div class="input-group">
              <label for="start-date">시작 날짜</label>
              <input type="date" id="start-date" />
            </div>
            <div class="input-group">
              <label for="end-date">종료 날짜</label>
              <input type="date" id="end-date" />
            </div>
            <button id="load-chart-btn" class="submit-btn">그래프 불러오기</button>
          </div>
          
          <div class="chart-container">
            <canvas id="weight-bmi-chart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- 경로 자동 수정: /recordManagement로 접근하면 /recordManagement.html로 리다이렉트 -->
  <script>
    if (window.location.pathname === '/recordManagement' || window.location.pathname === '/recordManagement/') {
      window.location.replace('/recordManagement.html');
    }
  </script>
  <script type="module" src="/src/recordManagement.js"></script>
</body>
</html>

