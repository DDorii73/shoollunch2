rules_version = '2';
service firebase.storage {
  match /b/{bucket}/o {
    // ============================================
    // 관리자 UID 설정
    // ============================================
    // 아래 함수에 관리자 UID를 추가하세요.
    // 여러 관리자를 추가하려면 || (OR) 연산자로 연결하세요.
    function isAdmin() {
      return request.auth != null && (
        request.auth.uid == '6yQL5PTLNkSqzP6CBUUoqbpt1M72' ||
        request.auth.uid == 'another-admin-uid-here'
        // 필요에 따라 더 많은 관리자 UID 추가 가능
        // 예: || request.auth.uid == 'third-admin-uid'
      );
    }
    
    // ============================================
    // 사용자별 파일 저장소
    // ============================================
    // 일반 사용자: 본인 폴더만 읽기/쓰기 가능
    // 관리자: 모든 사용자 폴더 읽기/삭제 가능
    
    // 사용자별 파일 (users/{userId}/...)
    match /users/{userId}/{allPaths=**} {
      // 본인 파일 읽기/쓰기
      allow read, write: if request.auth != null && request.auth.uid == userId;
      
      // 관리자는 모든 사용자 파일 읽기/삭제 가능
      allow read, delete: if isAdmin();
    }
    
    // 공용 파일 (public/...)
    // 모든 인증된 사용자가 읽기 가능
    match /public/{allPaths=**} {
      allow read: if request.auth != null;
      allow write: if false; // 공용 폴더는 쓰기 불가 (필요시 관리자만 쓰기 허용)
      allow delete: if isAdmin(); // 관리자만 삭제 가능
    }
    
    // ============================================
    // 기본 규칙: 나머지 모든 파일
    // ============================================
    // 인증된 사용자만 접근 가능 (보안을 위해 기본적으로 거부)
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

