rules_version = '2';

// 관리자 UID 목록 (여러 개의 UID를 쉼표로 구분하여 추가 가능)
// 실제 배포 시 여기에 관리자 UID를 입력하세요
function isAdmin() {
  return request.auth != null && 
         request.auth.uid in ['YOUR_ADMIN_UID_1', 'YOUR_ADMIN_UID_2']; // 여기에 실제 관리자 UID를 입력하세요
}

// 인증된 사용자인지 확인
function isAuthenticated() {
  return request.auth != null;
}

// 자신의 데이터인지 확인 (경로에서 userId 추출)
function isOwner(userId) {
  return isAuthenticated() && request.auth.uid == userId;
}

service firebase.storage {
  match /b/{bucket}/o {
    
    // users/{userId}/ 경로: 사용자별 이미지 및 파일
    match /users/{userId}/{allPaths=**} {
      // 읽기: 자신의 데이터 또는 관리자
      allow read: if isOwner(userId) || isAdmin();
      
      // 쓰기: 자신의 데이터만 또는 관리자
      allow write: if isOwner(userId) || isAdmin();
      
      // 삭제: 관리자만
      allow delete: if isAdmin();
    }
    
    // images/{userId}/ 경로: 사용자별 이미지 (대체 경로)
    match /images/{userId}/{allPaths=**} {
      // 읽기: 자신의 데이터 또는 관리자
      allow read: if isOwner(userId) || isAdmin();
      
      // 쓰기: 자신의 데이터만 또는 관리자
      allow write: if isOwner(userId) || isAdmin();
      
      // 삭제: 관리자만
      allow delete: if isAdmin();
    }
    
    // chatImages/{userId}/ 경로: 챗봇 대화 관련 이미지
    match /chatImages/{userId}/{allPaths=**} {
      // 읽기: 자신의 데이터 또는 관리자
      allow read: if isOwner(userId) || isAdmin();
      
      // 쓰기: 자신의 데이터만 또는 관리자
      allow write: if isOwner(userId) || isAdmin();
      
      // 삭제: 관리자만
      allow delete: if isAdmin();
    }
    
    // 다른 모든 경로는 기본적으로 거부
    match /{allPaths=**} {
      allow read, write: if false;
    }
  }
}

